version: "3.8"

services:
    minio:
        image: minio/minio
        container_name: minio
        ports:
            - "9000:9000" # API port
            - "9001:9001" # Console port
        environment:
            - MINIO_ROOT_USER=minioadmin
            - MINIO_ROOT_PASSWORD=minioadmin
        volumes:
            - ./minio:/data # Ánh xạ thư mục lưu trữ MinIO (không cần realtime, chỉ lưu data)
        command: server /data --console-address ":9001"
        restart: unless-stopped # Tự khởi động lại nếu crash

    backend:
        image: node:20-alpine # Sử dụng image Node.js nhẹ (có thể thay bằng node:latest nếu cần)
        container_name: backend
        working_dir: /app/backend # Thư mục làm việc trong container
        ports:
            - "3001:3001" # Giả sử backend chạy trên cổng 3000 (thay đổi nếu khác)
        volumes:
            - ./backend:/app/backend # Ánh xạ thư mục backend để realtime code changes
            - /app/backend/node_modules # Tránh sync node_modules để tránh xung đột
        command: sh -c "npm install && npm run start:dev" # Cài dependencies và chạy dev mode
        restart: unless-stopped
        depends_on:
            - minio # Đợi MinIO khởi động trước

    frontend:
        image: node:20-alpine
        container_name: frontend
        working_dir: /app/frontend
        ports:
            - "3000:3000" # Giả sử frontend (Vite) chạy trên cổng 5173 (thay đổi nếu khác, ví dụ 3000 cho React)
        volumes:
            - ./frontend:/app/frontend # Ánh xạ thư mục frontend để realtime code changes
            - /app/frontend/node_modules # Tránh sync node_modules
        command: sh -c "npm install && npm run dev" # Cài dependencies và chạy dev mode
        restart: unless-stopped
        depends_on:
            - backend # Đợi backend khởi động trước (nếu frontend phụ thuộc backend)

volumes:
    minio: # Định nghĩa volume cho MinIO (nếu cần lưu trữ bền vững)
